---
import {getCollection, render} from 'astro:content';
import Layout from "../../layouts/Layout.astro";
import Prose from "../../components/Prose.astro";
import Image from 'astro/components/Image.astro';
import Button from "../../components/ui/Button.astro";
import {dynamicImages} from "../../lib/images.ts";
import Sharer from '../../components/block/Sharer.svelte'
import Newsletter from "../../components/block/Newsletter.astro";
export async function getStaticPaths() {
  const stories = await getCollection('stories');
  return stories.map(item => ({
    params: {id: item.id},
    props: {item},
  }));
}
const {item} = Astro.props;
const {Content} = await render(item);
const data = item.data
const images = dynamicImages(import.meta.glob<{
  default: ImageMetadata
}>('/src/assets/stories/*.{jpeg,jpg,png,gif,svg}'))
const image = images(data.image)
const logo = images(data.logo)
---

<Layout title={item.data.title}>
    <header class="h-115 sm:h-163 relative flex flex-col justify-end">
        <Image src={image} height={652} layout="constrained" alt=""
               class="absolute inset-0 object-cover size-full z-1"/>
        <div class="flex flex-col gap-6 z-3 relative p-5 sm:mb-37 sm:container sm:py-0">
            <Image src={logo} height={23} layout="constrained" alt={`Logo ${data.company.name}`} class="intersect-once intersect:animate-slide-in"/>
            <h1 class="text-h3 text-invert font-medium sm:text-h2 intersect-once intersect:animate-slide-in motion-delay-50">{data.title}</h1>
        </div>
    </header>

    <div class="mx-5 mt-10 mb-6 flex flex-col gap-4 sm:grid grid-cols-3 sm:my-0 sm:-mt-[50px] sm:container z-5 relative sm:-translate-y-12">
      {data.impacts.map((impact, k) => (
              <div class="intersect-once intersect:animate-slide-in" style={`--motion-delay:${k * 100 + 100}ms`}>
                  <div class="text-h4 font-medium sm:text-invert">{impact.title}</div>
                  <div class="text-lg text-muted-foreground sm:text-tertiary-foreground">{impact.label}</div>
              </div>
      ))}
    </div>

    <main class="container flex flex-col gap-10 sm:grid grid-cols-[1fr_320px] sm:my-20">
        <Prose>
            <Content/>
        </Prose>
        <hr class="-mr-5 sm:hidden"/>
        <aside class="text-xs space-y-6 @container">
            <div class="space-y-2">
                <Sharer class="text-start items-start" gap={4}/>
            </div>
            <div class="space-y-2">
                <div class="font-medium">Company name</div>
                <div class="text-muted-foreground">{data.company.name}</div>
            </div>
            <div class="space-y-2">
                <div class="font-medium">Industry</div>
                <div class="text-muted-foreground">{data.company.industry}</div>
            </div>
            <div class="space-y-2">
                <div class="font-medium">Company type</div>
                <div class="text-muted-foreground">{data.company.type}</div>
            </div>
            <div class="space-y-2">
                <div class="font-medium">About the company</div>
                <div class="text-muted-foreground">{data.company.about}</div>
            </div>
            <hr/>
            <Newsletter/>
        </aside>
    </main>


</Layout>

<style>
    header::after {
        content: '';
        position: absolute;
        inset: 0;
        z-index: 2;
        background: linear-gradient(180deg, rgba(0, 0, 0, 0) 6.73%, #000000 100%);
    }
</style>
